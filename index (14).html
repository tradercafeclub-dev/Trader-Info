<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TCC - Trader Cafe Club</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Sarabun:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --gold: #F0B90B; --gold-light: #FFD700; --gold-dark: #C99A00;
  --black: #0B0E11; --dark: #12161C; --dark2: #1E2329; --dark3: #2B3139; --dark4: #3C4350;
  --text: #EAECEF; --text-muted: #848E9C;
  --green: #03C075; --red: #F6465D; --border: rgba(240,185,11,0.2);
}
* { margin:0; padding:0; box-sizing:border-box; }
body { background:var(--black); color:var(--text); font-family:'Sarabun',sans-serif; min-height:100vh; overflow-x:hidden; }
body::before {
  content:''; position:fixed; top:0; left:0; right:0; bottom:0;
  background: radial-gradient(ellipse at 20% 20%, rgba(240,185,11,0.05) 0%, transparent 50%),
              radial-gradient(ellipse at 80% 80%, rgba(240,185,11,0.03) 0%, transparent 50%);
  pointer-events:none; z-index:0;
}
.navbar {
  position:sticky; top:0; z-index:100; background:rgba(11,14,17,0.95);
  border-bottom:1px solid var(--border); backdrop-filter:blur(10px);
  padding:0 20px; display:flex; align-items:center; justify-content:space-between; height:60px;
}
.navbar-brand { display:flex; align-items:center; gap:10px; }
.navbar-brand img { height:38px; }
.navbar-brand span { font-family:'Orbitron',monospace; font-size:0.85rem; color:var(--gold); letter-spacing:2px; }
.nav-tabs { display:flex; gap:2px; }
.nav-tab { padding:8px 16px; border:none; background:transparent; color:var(--text-muted); cursor:pointer; border-radius:6px; font-family:'Sarabun',sans-serif; font-size:0.85rem; transition:all 0.2s; }
.nav-tab:hover { color:var(--gold); background:rgba(240,185,11,0.1); }
.nav-tab.active { color:var(--gold); background:rgba(240,185,11,0.15); border-bottom:2px solid var(--gold); }
.badge-admin { background:linear-gradient(135deg,var(--gold),var(--gold-dark)); color:var(--black); padding:4px 12px; border-radius:20px; font-size:0.75rem; font-weight:700; }
.page { display:none; padding:20px; max-width:1200px; margin:0 auto; animation:fadeIn 0.3s ease; position:relative; z-index:1; }
.page.active { display:block; }
@keyframes fadeIn { from{opacity:0;transform:translateY(10px);} to{opacity:1;transform:translateY(0);} }
.card { background:var(--dark2); border:1px solid var(--border); border-radius:12px; padding:20px; margin-bottom:16px; }
.card-header { display:flex; align-items:center; gap:10px; margin-bottom:16px; padding-bottom:12px; border-bottom:1px solid var(--border); }
.card-title { font-size:1rem; font-weight:700; color:var(--gold); }
.card-icon { width:32px; height:32px; background:rgba(240,185,11,0.15); border-radius:8px; display:flex; align-items:center; justify-content:center; font-size:1rem; }
.stats-row { display:grid; grid-template-columns:repeat(auto-fit,minmax(140px,1fr)); gap:12px; margin-bottom:20px; }
.stat-card { background:var(--dark2); border:1px solid var(--border); border-radius:10px; padding:16px; text-align:center; position:relative; overflow:hidden; }
.stat-card::before { content:''; position:absolute; top:0; left:0; right:0; height:2px; background:linear-gradient(90deg,var(--gold),var(--gold-dark)); }
.stat-value { font-size:1.4rem; font-weight:700; color:var(--gold); font-family:'Orbitron',monospace; }
.stat-label { font-size:0.75rem; color:var(--text-muted); margin-top:4px; }
.form-group { margin-bottom:14px; }
.form-label { font-size:0.8rem; color:var(--text-muted); margin-bottom:6px; display:block; }
.form-control { width:100%; padding:10px 14px; background:var(--dark3); border:1px solid var(--border); border-radius:8px; color:var(--text); font-family:'Sarabun',sans-serif; font-size:0.9rem; transition:border-color 0.2s; }
.form-control:focus { outline:none; border-color:var(--gold); box-shadow:0 0 0 2px rgba(240,185,11,0.15); }
select.form-control option { background:var(--dark3); }
.btn { padding:10px 20px; border:none; border-radius:8px; cursor:pointer; font-family:'Sarabun',sans-serif; font-size:0.9rem; font-weight:600; transition:all 0.2s; display:inline-flex; align-items:center; gap:6px; }
.btn-gold { background:linear-gradient(135deg,var(--gold),var(--gold-dark)); color:var(--black); }
.btn-gold:hover { transform:translateY(-1px); box-shadow:0 4px 15px rgba(240,185,11,0.4); }
.btn-outline { background:transparent; border:1px solid var(--border); color:var(--text); }
.btn-outline:hover { border-color:var(--gold); color:var(--gold); }
.btn-sm { padding:6px 14px; font-size:0.8rem; }
.btn-danger { background:rgba(246,70,93,0.15); border:1px solid rgba(246,70,93,0.3); color:var(--red); }
.btn-success { background:rgba(3,192,117,0.15); border:1px solid rgba(3,192,117,0.3); color:var(--green); }
.btn-full { width:100%; justify-content:center; }
.search-box { position:relative; margin-bottom:16px; }
.search-box input { padding-left:40px; }
.search-box::before { content:'üîç'; position:absolute; left:12px; top:50%; transform:translateY(-50%); font-size:0.9rem; }
.table-wrap { overflow-x:auto; }
table { width:100%; border-collapse:collapse; font-size:0.85rem; }
th { background:var(--dark3); color:var(--gold); padding:10px 12px; text-align:left; font-size:0.75rem; letter-spacing:1px; white-space:nowrap; }
td { padding:10px 12px; border-bottom:1px solid rgba(255,255,255,0.05); white-space:nowrap; }
tr:hover td { background:rgba(240,185,11,0.03); }
.badge { padding:3px 10px; border-radius:20px; font-size:0.72rem; font-weight:600; }
.badge-approve { background:rgba(3,192,117,0.15); color:var(--green); border:1px solid rgba(3,192,117,0.3); }
.badge-pending { background:rgba(240,185,11,0.15); color:var(--gold); border:1px solid rgba(240,185,11,0.3); }
.grid-2 { display:grid; grid-template-columns:1fr 1fr; gap:16px; }
.grid-3 { display:grid; grid-template-columns:1fr 1fr 1fr; gap:16px; }
@media(max-width:768px) { .grid-2,.grid-3 { grid-template-columns:1fr; } .nav-tabs { display:none; } }
.member-info-panel { background:var(--dark3); border:1px solid var(--border); border-radius:10px; padding:16px; margin-bottom:16px; }
.member-info-row { display:flex; justify-content:space-between; padding:8px 0; border-bottom:1px solid rgba(255,255,255,0.05); font-size:0.85rem; }
.member-info-row:last-child { border-bottom:none; }
.info-key { color:var(--text-muted); }
.info-val { color:var(--text); font-weight:600; }
.profit-breakdown { background:linear-gradient(135deg,rgba(240,185,11,0.08),rgba(240,185,11,0.03)); border:1px solid var(--border); border-radius:12px; padding:20px; margin-top:16px; }
.profit-row { display:flex; justify-content:space-between; align-items:center; padding:10px 0; border-bottom:1px solid rgba(255,255,255,0.05); }
.profit-row:last-child { border-bottom:none; }
.profit-label { font-size:0.85rem; color:var(--text-muted); }
.profit-val { font-weight:700; font-size:0.95rem; }
.profit-val.gold { color:var(--gold); }
.profit-val.green { color:var(--green); }
.profit-val.red { color:var(--red); }
.trade-item { background:var(--dark3); border:1px solid var(--border); border-radius:8px; padding:12px; margin-bottom:8px; display:flex; align-items:center; gap:12px; flex-wrap:wrap; }
.trade-item-num { width:28px; height:28px; background:rgba(240,185,11,0.2); border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:0.8rem; font-weight:700; color:var(--gold); flex-shrink:0; }
.wallet-box { background:var(--dark3); border:1px solid var(--gold); border-radius:10px; padding:16px; display:flex; align-items:center; gap:12px; flex-wrap:wrap; }
.wallet-addr { font-family:monospace; font-size:0.8rem; color:var(--gold); word-break:break-all; flex:1; }
.verify-box { background:linear-gradient(135deg,rgba(3,192,117,0.1),rgba(3,192,117,0.05)); border:1px solid rgba(3,192,117,0.3); border-radius:10px; padding:16px; margin-top:16px; }
.verify-status { display:flex; align-items:center; gap:8px; font-weight:600; }
.pulse { width:10px; height:10px; background:var(--green); border-radius:50%; animation:pulse 1.5s infinite; }
@keyframes pulse { 0%,100%{opacity:1;transform:scale(1);} 50%{opacity:0.5;transform:scale(1.3);} }
.mobile-nav { display:none; position:fixed; bottom:0; left:0; right:0; background:rgba(11,14,17,0.97); border-top:1px solid var(--border); padding:8px; z-index:100; grid-template-columns:repeat(4,1fr); }
@media(max-width:768px) { .mobile-nav { display:grid; } body { padding-bottom:70px; } }
.mobile-nav-btn { display:flex; flex-direction:column; align-items:center; gap:3px; padding:6px 4px; border:none; background:transparent; color:var(--text-muted); cursor:pointer; font-size:0.65rem; font-family:'Sarabun',sans-serif; border-radius:8px; transition:all 0.2s; }
.mobile-nav-btn.active { color:var(--gold); }
.mobile-nav-btn span:first-child { font-size:1.2rem; }
.page-title { margin-bottom:20px; }
.page-title h1 { font-size:1.3rem; font-weight:700; color:var(--gold); }
.page-title p { color:var(--text-muted); font-size:0.85rem; margin-top:4px; }
.modal-overlay { display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.85); z-index:200; align-items:center; justify-content:center; padding:20px; }
.modal-overlay.open { display:flex; }
.modal { background:var(--dark2); border:1px solid var(--border); border-radius:16px; padding:24px; max-width:680px; width:100%; max-height:90vh; overflow-y:auto; animation:slideUp 0.3s ease; }
@keyframes slideUp { from{transform:translateY(30px);opacity:0;} to{transform:translateY(0);opacity:1;} }
.modal-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; }
.modal-title { font-size:1.1rem; font-weight:700; color:var(--gold); }
.modal-close { background:none; border:none; color:var(--text-muted); font-size:1.3rem; cursor:pointer; }
.steps { display:flex; gap:8px; margin-bottom:20px; }
.step { flex:1; height:3px; background:var(--dark3); border-radius:2px; transition:background 0.3s; }
.step.active { background:var(--gold); }
::-webkit-scrollbar { width:6px; height:6px; }
::-webkit-scrollbar-track { background:var(--dark); }
::-webkit-scrollbar-thumb { background:var(--dark4); border-radius:3px; }
::-webkit-scrollbar-thumb:hover { background:var(--gold-dark); }
.sep { height:1px; background:var(--border); margin:16px 0; }
.hero { text-align:center; padding:40px 20px; background:linear-gradient(135deg,rgba(240,185,11,0.05) 0%,transparent 60%); border:1px solid var(--border); border-radius:16px; margin-bottom:24px; }
.hero img { height:70px; margin-bottom:16px; }
.hero h1 { font-family:'Orbitron',monospace; font-size:1.8rem; color:var(--gold); letter-spacing:3px; }
.hero p { color:var(--text-muted); margin-top:8px; font-size:0.9rem; }
/* Loading */
.loading-overlay { position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(11,14,17,0.9); z-index:300; display:flex; flex-direction:column; align-items:center; justify-content:center; }
.loading-spinner { width:50px; height:50px; border:3px solid var(--dark3); border-top:3px solid var(--gold); border-radius:50%; animation:spin 0.8s linear infinite; margin-bottom:16px; }
@keyframes spin { to{transform:rotate(360deg);} }
.loading-text { color:var(--gold); font-family:'Orbitron',monospace; font-size:0.8rem; letter-spacing:2px; }
.api-error { background:rgba(246,70,93,0.1); border:1px solid rgba(246,70,93,0.3); border-radius:8px; padding:12px; color:var(--red); font-size:0.85rem; margin-bottom:12px; }
.api-success { background:rgba(3,192,117,0.1); border:1px solid rgba(3,192,117,0.3); border-radius:8px; padding:12px; color:var(--green); font-size:0.85rem; margin-bottom:12px; }
</style>
</head>
<body>

<!-- LOADING -->
<div class="loading-overlay" id="loading-overlay">
  <div class="loading-spinner"></div>
  <div class="loading-text" id="loading-text">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>
</div>

<!-- TOP NAVBAR -->
<nav class="navbar">
  <div class="navbar-brand">
    <img src="https://i.ibb.co/NbQpSTX/TCC-Logo.png" alt="TCC" onerror="this.style.display='none'">
    <span>TRADER CAFE CLUB</span>
  </div>
  <div class="nav-tabs">
    <button class="nav-tab active" onclick="showPage('home')">üè† ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
    <button class="nav-tab" onclick="showPage('member-search')">üë§ ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
    <button class="nav-tab" onclick="showPage('register')">üìù ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
    <button class="nav-tab" onclick="showPage('admin')">‚öôÔ∏è ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</button>
  </div>
  <div style="display:flex;align-items:center;gap:8px;">
    <div id="db-status" style="font-size:0.7rem;color:var(--text-muted);">‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...</div>
    <span class="badge-admin">ADMIN</span>
  </div>
</nav>

<!-- ===================== HOME ===================== -->
<div id="page-home" class="page active">
  <div class="hero">
    <img src="https://i.ibb.co/NbQpSTX/TCC-Logo.png" alt="TCC Logo" onerror="this.style.display='none'">
    <h1>TRADER CAFE CLUB</h1>
    <p>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏ú‡∏•‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ó‡∏£‡∏î ‚Äî ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ NocoDB Live</p>
  </div>
  
  <div class="stats-row">
    <div class="stat-card">
      <div class="stat-value" id="stat-members">‚Äî</div>
      <div class="stat-label">‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
    </div>
    <div class="stat-card">
      <div class="stat-value" id="stat-teams">‚Äî</div>
      <div class="stat-label">‡∏ó‡∏µ‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
    </div>
    <div class="stat-card">
      <div class="stat-value" id="stat-payments">‚Äî</div>
      <div class="stat-label">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞</div>
    </div>
    <div class="stat-card">
      <div class="stat-value" id="stat-pending" style="color:var(--gold)">‚Äî</div>
      <div class="stat-label">‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</div>
    </div>
    <div class="stat-card" style="grid-column:span 2;">
      <div style="font-size:0.7rem;color:var(--text-muted);margin-bottom:4px;">üí∞ ‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏ó‡∏£‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
      <div class="stat-value" id="stat-total-profit" style="font-size:1.5rem;">‚Äî</div>
      <div class="stat-label">Total Profit (USD)</div>
    </div>
  </div>

  <div class="grid-2">
    <div class="card" style="cursor:pointer" onclick="showPage('member-search')">
      <div class="card-header">
        <div class="card-icon">üë§</div>
        <span class="card-title">‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô</span>
      </div>
      <p style="color:var(--text-muted);font-size:0.85rem;">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏•‡∏∞‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡∏Ç‡∏≠‡∏á‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</p>
    </div>
    <div class="card" style="cursor:pointer" onclick="showPage('register')">
      <div class="card-header">
        <div class="card-icon">üìù</div>
        <span class="card-title">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏´‡∏°‡πà</span>
      </div>
      <p style="color:var(--text-muted);font-size:0.85rem;">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</p>
    </div>
  </div>

  <div class="card">
    <div class="card-header">
      <div class="card-icon">üìä</div>
      <span class="card-title">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</span>
      <button class="btn btn-outline btn-sm" style="margin-left:auto" onclick="loadPayments()">üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä</button>
    </div>
    <div class="table-wrap">
      <table>
        <thead>
          <tr><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th><th>‡∏ä‡∏∑‡πà‡∏≠</th><th>‡∏ó‡∏µ‡∏°</th><th>‡∏Å‡∏≥‡πÑ‡∏£‡∏£‡∏ß‡∏°</th><th>‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th></tr>
        </thead>
        <tbody id="recent-payments-table">
          <tr><td colspan="6" style="text-align:center;color:var(--text-muted);padding:20px;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</td></tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- ===================== MEMBER SEARCH ===================== -->
<div id="page-member-search" class="page">
  <div class="page-title">
    <h1>üí≥ ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô</h1>
    <p>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏à‡∏≤‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</p>
  </div>
  <div class="card">
    <div class="search-box">
      <input type="text" class="form-control" id="member-search-input" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠ ‡∏´‡∏£‡∏∑‡∏≠ BNB ID..." oninput="searchMember()">
    </div>
    <div id="member-search-results" style="display:none;">
      <div style="font-size:0.8rem;color:var(--text-muted);margin-bottom:8px;">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</div>
      <div id="member-results-list"></div>
    </div>
  </div>

  <div id="member-dashboard" style="display:none;">
    <div class="card">
      <div class="card-header">
        <div class="card-icon">üë§</div>
        <span class="card-title">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</span>
        <button class="btn btn-outline btn-sm" onclick="closeMemberDash()" style="margin-left:auto">‚úï ‡∏õ‡∏¥‡∏î</button>
      </div>
      <div class="grid-2">
        <div>
          <div class="member-info-row"><span class="info-key">‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</span><span class="info-val" id="dash-name">-</span></div>
          <div class="member-info-row"><span class="info-key">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</span><span class="info-val" id="dash-id">-</span></div>
          <div class="member-info-row"><span class="info-key">‡∏ó‡∏µ‡∏°‡∏™‡∏±‡∏á‡∏Å‡∏±‡∏î</span><span class="info-val" id="dash-team">-</span></div>
          <div class="member-info-row"><span class="info-key">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</span><span class="info-val" id="dash-status">-</span></div>
        </div>
        <div>
          <div style="font-size:0.8rem;color:var(--text-muted);margin-bottom:8px;">‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤ USDT (BEP-20)</div>
          <div class="wallet-box" style="margin-bottom:12px;">
            <span class="wallet-addr" id="dash-wallet">-</span>
            <button class="btn btn-outline btn-sm" onclick="copyText('dash-wallet')">üìã</button>
          </div>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-header">
        <div class="card-icon">üìã</div>
        <span class="card-title">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</span>
        <div style="margin-left:auto;display:flex;gap:8px;">
          <button class="btn btn-outline btn-sm" onclick="filterPayments('all')">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
          <button class="btn btn-outline btn-sm" onclick="filterPayments('Approve')">‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß</button>
          <button class="btn btn-outline btn-sm" onclick="filterPayments('Pending')">‡∏£‡∏≠‡∏ä‡∏≥‡∏£‡∏∞</button>
        </div>
      </div>
      <div class="table-wrap">
        <table>
          <thead>
            <tr><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th><th>‡∏Å‡∏≥‡πÑ‡∏£‡∏£‡∏ß‡∏°</th><th>‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏° 10%</th><th>‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô 10%</th><th>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ 80%</th><th>‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å 50%</th><th>‡∏£‡∏∞‡∏ö‡∏ö 50%</th><th>‡πÇ‡∏≠‡∏ô‡∏£‡∏ß‡∏°</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th></tr>
          </thead>
          <tbody id="member-payments-table"></tbody>
        </table>
      </div>
      <div id="member-no-data" style="text-align:center;padding:30px;color:var(--text-muted);display:none;">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</div>
    </div>
  </div>
</div>

<!-- ===================== ADMIN ===================== -->
<div id="page-admin" class="page">
  <div class="page-title">
    <h1>‚öôÔ∏è ‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</h1>
    <p>‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏ö</p>
  </div>

  <div class="grid-2" style="margin-bottom:20px;">
    <div class="card" style="cursor:pointer;margin-bottom:0;" onclick="showPage('teams')">
      <div class="card-header" style="margin-bottom:0;border:none;padding-bottom:0;">
        <div class="card-icon">üèÜ</div>
        <span class="card-title">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡∏°</span>
      </div>
    </div>
    <div class="card" style="margin-bottom:0;">
      <div class="card-header" style="margin-bottom:0;border:none;padding-bottom:0;">
        <div class="card-icon">üìä</div>
        <span class="card-title" id="admin-stat-label">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ‚Äî</span>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="card-header">
      <div class="card-icon">üîç</div>
      <span class="card-title">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</span>
    </div>
    <div class="search-box">
      <input type="text" class="form-control" id="admin-search" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠ ‡∏´‡∏£‡∏∑‡∏≠ BNB ID..." oninput="adminSearchMember()">
    </div>
    <div id="admin-search-results"></div>
  </div>

  <div id="admin-payment-form" style="display:none;">
    <div class="card">
      <div class="card-header">
        <div class="card-icon">üë§</div>
        <span class="card-title">‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</span>
        <button class="btn btn-outline btn-sm" onclick="clearAdminForm()" style="margin-left:auto">‚úï ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
      </div>
      <div class="grid-3" style="font-size:0.85rem;">
        <div class="member-info-row"><span class="info-key">BNB ID</span><span class="info-val" id="af-id">-</span></div>
        <div class="member-info-row"><span class="info-key">‡∏ä‡∏∑‡πà‡∏≠</span><span class="info-val" id="af-name">-</span></div>
        <div class="member-info-row"><span class="info-key">‡∏ó‡∏µ‡∏°</span><span class="info-val" id="af-team">-</span></div>
        <div class="member-info-row"><span class="info-key">Level A</span><span class="info-val" id="af-lva">-</span></div>
        <div class="member-info-row"><span class="info-key">Level B</span><span class="info-val" id="af-lvb">-</span></div>
        <div class="member-info-row"><span class="info-key">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span><span class="info-val" id="af-date">-</span></div>
      </div>
    </div>

    <div class="card">
      <div class="card-header">
        <div class="card-icon">üìà</div>
        <span class="card-title">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏ó‡∏£‡∏î</span>
        <button class="btn btn-gold btn-sm" onclick="addTradeRow()" style="margin-left:auto">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
      </div>
      <div id="trade-rows"></div>
      <div class="sep"></div>
      <div style="display:flex;justify-content:space-between;align-items:center;padding:8px 0;">
        <span style="color:var(--text-muted);font-size:0.85rem;">‡∏Å‡∏≥‡πÑ‡∏£‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span>
        <span style="color:var(--gold);font-size:1.2rem;font-weight:700;font-family:'Orbitron',monospace" id="total-trade-profit">$0.00</span>
      </div>
    </div>

    <div class="card">
      <div class="card-header">
        <div class="card-icon">üßÆ</div>
        <span class="card-title">‡∏Å‡∏≤‡∏£‡πÅ‡∏ö‡πà‡∏á‡∏õ‡∏±‡∏ô‡∏ú‡∏•‡∏Å‡∏≥‡πÑ‡∏£</span>
      </div>
      <div class="profit-breakdown">
        <div class="profit-row"><span class="profit-label">üí∞ ‡∏Å‡∏≥‡πÑ‡∏£‡πÄ‡∏ó‡∏£‡∏î‡∏£‡∏ß‡∏° (100%)</span><span class="profit-val gold" id="calc-total">$0.00</span></div>
        <div class="profit-row"><span class="profit-label">üõ°Ô∏è ‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏Å‡∏≥‡πÑ‡∏£‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ (10%)</span><span class="profit-val red" id="calc-guarantee">-$0.00</span></div>
        <div class="profit-row"><span class="profit-label">ü§ù ‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏°‡∏°‡∏¥‡∏ä‡∏±‡πà‡∏ô‡∏ó‡∏µ‡∏° (10%)</span><span class="profit-val red" id="calc-commission">-$0.00</span></div>
        <div class="profit-row" style="background:rgba(240,185,11,0.05);border-radius:6px;padding:10px;">
          <span class="profit-label" style="font-weight:600;">‚ö° ‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏∏‡∏ó‡∏ò‡∏¥ (80%)</span>
          <span class="profit-val gold" id="calc-balance">$0.00</span>
        </div>
        <div class="profit-row"><span class="profit-label">üë§ ‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏ö‡πà‡∏á‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å (50% ‡∏Ç‡∏≠‡∏á 80%)</span><span class="profit-val green" id="calc-member">$0.00</span></div>
        <div class="profit-row"><span class="profit-label">üè¢ ‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏ö‡πà‡∏á‡∏£‡∏∞‡∏ö‡∏ö (50% ‡∏Ç‡∏≠‡∏á 80%)</span><span class="profit-val gold" id="calc-central">$0.00</span></div>
        <div style="border-top:2px solid var(--border);padding-top:12px;margin-top:8px;display:flex;justify-content:space-between;">
          <span style="font-weight:700;">üíé ‡∏¢‡∏≠‡∏î‡πÇ‡∏≠‡∏ô‡∏£‡∏ß‡∏° (‡∏£‡∏∞‡∏ö‡∏ö + ‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏°)</span>
          <span id="calc-transfer" style="color:var(--gold);font-size:1.1rem;font-weight:700;">$0.00</span>
        </div>
      </div>
      <div class="sep"></div>
      <div class="grid-2">
        <div class="form-group">
          <label class="form-label">üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô</label>
          <input type="date" class="form-control" id="af-payment-date">
        </div>
        <div class="form-group">
          <label class="form-label">üìä ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</label>
          <select class="form-control" id="af-position">
            <option value="Pending">‚è≥ ‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</option>
            <option value="Approve">‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ / ‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß</option>
          </select>
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
        <input type="text" class="form-control" id="af-note" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)">
      </div>
      <div class="sep"></div>
      <div style="font-size:0.9rem;font-weight:600;color:var(--gold);margin-bottom:12px;">üîê ‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤ USDT (BEP-20) ‡∏£‡∏∞‡∏ö‡∏ö</div>
      <div class="wallet-box" style="margin-bottom:16px;">
        <span class="wallet-addr">0xfd1A5bc82603a702a9AF38426FfAC0d6BE5aEeef</span>
        <button class="btn btn-outline btn-sm" onclick="copySystemWallet()">üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å</button>
      </div>
      <div class="verify-box">
        <div class="verify-status"><div class="pulse"></div><span style="color:var(--green)">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Blockchain (BSC)</span></div>
        <p style="font-size:0.8rem;color:var(--text-muted);margin-top:8px;">‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö USDT BEP-20 ‡∏à‡∏≤‡∏Å BscScan ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ 12 confirmations</p>
        <button class="btn btn-success btn-sm" style="margin-top:10px;" onclick="checkBlockchain()">üîç ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</button>
        <div id="blockchain-result" style="margin-top:10px;"></div>
      </div>
      <div class="sep"></div>
      <div id="save-result"></div>
      <button class="btn btn-gold btn-full" onclick="savePayment()" style="font-size:1rem;padding:14px;">
        üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ NocoDB
      </button>
    </div>
  </div>

  <div class="card">
    <div class="card-header">
      <div class="card-icon">üìã</div>
      <span class="card-title">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</span>
      <button class="btn btn-outline btn-sm" style="margin-left:auto" onclick="loadPayments()">üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä</button>
    </div>
    <div class="table-wrap">
      <table>
        <thead>
          <tr><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th><th>BNB ID</th><th>‡∏ä‡∏∑‡πà‡∏≠</th><th>‡∏ó‡∏µ‡∏°</th><th>‡∏Å‡∏≥‡πÑ‡∏£</th><th>‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</th><th>‡πÇ‡∏≠‡∏ô‡∏£‡∏ß‡∏°</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th><th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr>
        </thead>
        <tbody id="admin-payments-table">
          <tr><td colspan="9" style="text-align:center;color:var(--text-muted);padding:20px;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</td></tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- ===================== REGISTER ===================== -->
<div id="page-register" class="page">
  <div class="page-title">
    <h1>üìù ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏´‡∏°‡πà</h1>
    <p>‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏° Trader Cafe Club</p>
  </div>
  <div class="card">
    <div class="steps">
      <div class="step active" id="step-1"></div>
      <div class="step" id="step-2"></div>
      <div class="step" id="step-3"></div>
    </div>
    <div id="reg-step-1">
      <div style="color:var(--gold);font-weight:700;margin-bottom:16px;">‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</div>
      <div class="grid-2">
        <div class="form-group">
          <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠ - ‡∏™‡∏Å‡∏∏‡∏• *</label>
          <input type="text" class="form-control" id="reg-name" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•">
        </div>
        <div class="form-group">
          <label class="form-label">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå *</label>
          <input type="tel" class="form-control" id="reg-phone" placeholder="+66 8x-xxx-xxxx">
        </div>
        <div class="form-group">
          <label class="form-label">‡∏ó‡∏µ‡∏°‡∏™‡∏±‡∏á‡∏Å‡∏±‡∏î *</label>
          <select class="form-control" id="reg-team">
            <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡∏° --</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®</label>
          <select class="form-control" id="reg-country" onchange="toggleProvince()">
            <option value="TH" selected>üáπüá≠ ‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÑ‡∏ó‡∏¢</option>
            <option value="MM">üá≤üá≤ ‡πÄ‡∏°‡∏µ‡∏¢‡∏ô‡∏°‡∏≤‡∏£‡πå</option>
            <option value="KH">üá∞üá≠ ‡∏Å‡∏±‡∏°‡∏û‡∏π‡∏ä‡∏≤</option>
            <option value="LA">üá±üá¶ ‡∏•‡∏≤‡∏ß</option>
            <option value="VN">üáªüá≥ ‡πÄ‡∏ß‡∏µ‡∏¢‡∏î‡∏ô‡∏≤‡∏°</option>
            <option value="MY">üá≤üáæ ‡∏°‡∏≤‡πÄ‡∏•‡πÄ‡∏ã‡∏µ‡∏¢</option>
            <option value="SG">üá∏üá¨ ‡∏™‡∏¥‡∏á‡∏Ñ‡πÇ‡∏õ‡∏£‡πå</option>
            <option value="HK">üá≠üá∞ ‡∏Æ‡πà‡∏≠‡∏á‡∏Å‡∏á</option>
          </select>
        </div>
        <div class="form-group" id="province-group">
          <label class="form-label">‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</label>
          <select class="form-control" id="reg-province">
            <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î --</option>
          </select>
        </div>
      </div>
      <button class="btn btn-gold btn-full" onclick="regNext(2)">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚Üí</button>
    </div>
    <div id="reg-step-2" style="display:none;">
      <div style="color:var(--gold);font-weight:700;margin-bottom:16px;">‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Binance & Wallet</div>
      <div class="grid-2">
        <div class="form-group">
          <label class="form-label">Binance ID (BNB_ID) *</label>
          <input type="text" class="form-control" id="reg-bnbid" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç Binance ID">
        </div>
        <div class="form-group">
          <label class="form-label">‡πÅ‡∏ô‡∏ö‡∏†‡∏≤‡∏û‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ Binance *</label>
          <input type="file" class="form-control" id="reg-binance-img" accept="image/*">
        </div>
        <div class="form-group" style="grid-column:1/-1">
          <label class="form-label">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤ USDT (BEP-20) *</label>
          <input type="text" class="form-control" id="reg-wallet" placeholder="0x...">
        </div>
        <div class="form-group" style="grid-column:1/-1">
          <label class="form-label">QR Code ‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤ (‡πÅ‡∏ô‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏†‡∏≤‡∏û)</label>
          <input type="file" class="form-control" id="reg-qr" accept="image/*">
        </div>
      </div>
      <div style="display:flex;gap:8px;">
        <button class="btn btn-outline" onclick="regNext(1)" style="flex:1">‚Üê ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
        <button class="btn btn-gold" onclick="regNext(3)" style="flex:2">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚Üí</button>
      </div>
    </div>
    <div id="reg-step-3" style="display:none;">
      <div style="color:var(--gold);font-weight:700;margin-bottom:16px;">‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 3: ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>
      <div id="reg-summary" class="member-info-panel"></div>
      <div class="sep"></div>
      <div id="reg-result"></div>
      <div style="background:rgba(240,185,11,0.1);border:1px solid var(--border);border-radius:8px;padding:12px;margin-bottom:16px;">
        <p style="font-size:0.85rem;color:var(--text-muted);">üìß ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Ç‡πâ‡∏≤ NocoDB ‡πÅ‡∏•‡∏∞‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="4e3a3c2f2a2b3c2d2f282b2d223b2c0e29232f2722602d2123">[email&#160;protected]</a></p>
      </div>
      <div style="display:flex;gap:8px;">
        <button class="btn btn-outline" onclick="regNext(2)" style="flex:1">‚Üê ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
        <button class="btn btn-gold" onclick="submitRegistration()" style="flex:2">‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
      </div>
    </div>
  </div>
</div>

<!-- ===================== TEAMS ===================== -->
<div id="page-teams" class="page">
  <div class="page-title">
    <h1>üèÜ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡∏°</h1>
    <p>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å NocoDB</p>
  </div>
  <div class="card">
    <div class="card-header">
      <div class="card-icon">üèÜ</div>
      <span class="card-title">‡∏ó‡∏µ‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span>
      <button class="btn btn-outline btn-sm" style="margin-left:auto" onclick="loadTeams()">üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä</button>
    </div>
    <div id="teams-list">
      <div style="text-align:center;padding:30px;color:var(--text-muted);">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
    </div>
  </div>
</div>

<!-- MOBILE NAV -->
<nav class="mobile-nav">
  <button class="mobile-nav-btn active" onclick="showPage('home')"><span>üè†</span>‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
  <button class="mobile-nav-btn" onclick="showPage('member-search')"><span>üë§</span>‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
  <button class="mobile-nav-btn" onclick="showPage('register')"><span>üìù</span>‡∏™‡∏°‡∏±‡∏Ñ‡∏£</button>
  <button class="mobile-nav-btn" onclick="showPage('admin')"><span>‚öôÔ∏è</span>‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</button>
</nav>

<!-- SUCCESS MODAL -->
<div class="modal-overlay" id="success-modal">
  <div class="modal" style="text-align:center;max-width:360px;">
    <div style="font-size:3rem;margin-bottom:16px;" id="success-icon">‚úÖ</div>
    <div style="font-size:1.1rem;font-weight:700;color:var(--gold);margin-bottom:8px;" id="success-title">‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</div>
    <p id="success-msg" style="color:var(--text-muted);font-size:0.9rem;margin-bottom:20px;"></p>
    <button class="btn btn-gold btn-full" onclick="document.getElementById('success-modal').classList.remove('open')">‡∏ï‡∏Å‡∏•‡∏á</button>
  </div>
</div>

<!-- PAYMENT DETAIL MODAL -->
<div class="modal-overlay" id="payment-modal">
  <div class="modal">
    <div class="modal-header">
      <span class="modal-title">üí≥ ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</span>
      <button class="modal-close" onclick="document.getElementById('payment-modal').classList.remove('open')">‚úï</button>
    </div>
    <div id="payment-modal-content"></div>
  </div>
</div>

<script>
// ========== CONFIG ==========
const WORKER_URL = 'https://tcc-proxy.tradercafeclub.workers.dev';

const NDB = {
  SYSTEM_WALLET: '0xfd1A5bc82603a702a9AF38426FfAC0d6BE5aEeef'
};

// ===== FIELD NAME MAP ‡∏à‡∏≤‡∏Å NocoDB ‡∏à‡∏£‡∏¥‡∏á =====
// MEMBERS: Id, BNB_ID, Name, Team, QR Code, Address Wallet, Status
// PAYMENTS: Field 1(BNB_ID), Field 2(Team), Field 3(Name), Field 6(Date),
//           Field 8(TotalProfit), 10.00%(Commission), 10.00%1(Guarantee),
//           Field 11(Balance), 50.00%(Member), 50.00%1(Central),
//           Field 14(Transfer), Field 15(Position), Field 16(Note)
// TEAMS: ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡∏°(TeamName), ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡∏°(Status)

// Helper: ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å payments record ‡∏ï‡∏≤‡∏° semantic field
function payVal(p, field) {
  const MAP = {
    'bnb_id':    p['Field 1'],
    'team':      p['Field 2'],
    'name':      p['Field 3'],
    'lva':       p['Field 4'],
    'lvb':       p['Field 5'],
    'date':      p['Field 6'],
    'profit':    p['Field 8'],
    'commission':p['10.00%'],
    'guarantee': p['10.00%1'],
    'balance':   p['Field 11'],
    'member':    p['50.00%'],
    'central':   p['50.00%1'],
    'transfer':  p['Field 14'],
    'position':  p['Field 15'],
    'note':      p['Field 16'],
  };
  const v = MAP[field];
  return (v === undefined || v === null) ? '' : v;
}

function payNum(p, field) {
  const v = payVal(p, field);
  return parseFloat(String(v).replace(/[$,\s]/g, '')) || 0;
}

// Helper: ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å members record
function memVal(m, field) {
  const MAP = {
    'id':      m['BNB_ID'],
    'name':    m['Name'],
    'team':    m['Team'],
    'wallet':  m['Address Wallet'],
    'status':  m['Status'],
    'qr':      m['QR Code'],
    'lva':     m['Level A'],
    'lvb':     m['Level B'],
  };
  const v = MAP[field];
  return (v === undefined || v === null) ? '' : String(v);
}

// Helper: ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å teams record
function teamVal(t, field) {
  const MAP = {
    'name':   t['‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡∏°'],
    'status': t['‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡∏°'],
    'f2':     t['Field 2'],
    'f3':     t['Field 3'],
    'f4':     t['Field 4'],
    'f5':     t['Field 5'],
    'f6':     t['Field 6'],
  };
  const v = MAP[field];
  return (v === undefined || v === null) ? '' : String(v);
}

// ========== API HELPER (‡∏ú‡πà‡∏≤‡∏ô Cloudflare Worker) ==========
async function ndbFetch(table, params = {}) {
  const url = new URL(`${WORKER_URL}/api/${table}`);
  url.searchParams.set('limit', params.limit || 200);
  if (params.where) url.searchParams.set('where', params.where);
  if (params.sort)  url.searchParams.set('sort', params.sort);
  if (params.offset)url.searchParams.set('offset', params.offset);
  if (params.bnbId) url.searchParams.set('bnbId', params.bnbId);
  const res = await fetch(url.toString());
  if (!res.ok) {
    const err = await res.json().catch(() => ({}));
    throw new Error(err.error || `API Error: ${res.status}`);
  }
  return res.json();
}

async function ndbInsert(table, data) {
  const res = await fetch(`${WORKER_URL}/api/${table}`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(data)
  });
  if (!res.ok) {
    const err = await res.json().catch(() => ({}));
    throw new Error(err.error || `Insert Error: ${res.status}`);
  }
  return res.json();
}

async function ndbUpdate(table, rowId, data) {
  const res = await fetch(`${WORKER_URL}/api/${table}/${rowId}`, {
    method: 'PATCH',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(data)
  });
  if (!res.ok) {
    const err = await res.json().catch(() => ({}));
    throw new Error(err.error || `Update Error: ${res.status}`);
  }
  return res.json();
}

// ========== IN-MEMORY CACHE ==========
let MEMBERS = [], TEAMS = [], PAYMENTS = [];
let currentMemberPayments = [], selectedAdminMember = null, tradeRows = [];

const COINS = ['Gold','BTC','ETH','XRP','SOL','BNB','ADA','DOGE','MATIC','LINK','DOT','AVAX','LTC','TRX'];
const PROVINCES = ['‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏°‡∏´‡∏≤‡∏ô‡∏Ñ‡∏£','‡∏Å‡∏£‡∏∞‡∏ö‡∏µ‡πà','‡∏Å‡∏≤‡∏ç‡∏à‡∏ô‡∏ö‡∏∏‡∏£‡∏µ','‡∏Å‡∏≤‡∏¨‡∏™‡∏¥‡∏ô‡∏ò‡∏∏‡πå','‡∏Å‡∏≥‡πÅ‡∏û‡∏á‡πÄ‡∏û‡∏ä‡∏£','‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô','‡∏à‡∏±‡∏ô‡∏ó‡∏ö‡∏∏‡∏£‡∏µ','‡∏â‡∏∞‡πÄ‡∏ä‡∏¥‡∏á‡πÄ‡∏ó‡∏£‡∏≤','‡∏ä‡∏•‡∏ö‡∏∏‡∏£‡∏µ','‡∏ä‡∏±‡∏¢‡∏ô‡∏≤‡∏ó','‡∏ä‡∏±‡∏¢‡∏†‡∏π‡∏°‡∏¥','‡∏ä‡∏∏‡∏°‡∏û‡∏£','‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡∏£‡∏≤‡∏¢','‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà','‡∏ï‡∏£‡∏±‡∏á','‡∏ï‡∏£‡∏≤‡∏î','‡∏ï‡∏≤‡∏Å','‡∏ô‡∏Ñ‡∏£‡∏ô‡∏≤‡∏¢‡∏Å','‡∏ô‡∏Ñ‡∏£‡∏õ‡∏ê‡∏°','‡∏ô‡∏Ñ‡∏£‡∏û‡∏ô‡∏°','‡∏ô‡∏Ñ‡∏£‡∏£‡∏≤‡∏ä‡∏™‡∏µ‡∏°‡∏≤','‡∏ô‡∏Ñ‡∏£‡∏®‡∏£‡∏µ‡∏ò‡∏£‡∏£‡∏°‡∏£‡∏≤‡∏ä','‡∏ô‡∏Ñ‡∏£‡∏™‡∏ß‡∏£‡∏£‡∏Ñ‡πå','‡∏ô‡∏ô‡∏ó‡∏ö‡∏∏‡∏£‡∏µ','‡∏ô‡∏£‡∏≤‡∏ò‡∏¥‡∏ß‡∏≤‡∏™','‡∏ô‡πà‡∏≤‡∏ô','‡∏ö‡∏∂‡∏á‡∏Å‡∏≤‡∏¨','‡∏ö‡∏∏‡∏£‡∏µ‡∏£‡∏±‡∏°‡∏¢‡πå','‡∏õ‡∏ó‡∏∏‡∏°‡∏ò‡∏≤‡∏ô‡∏µ','‡∏õ‡∏£‡∏∞‡∏à‡∏ß‡∏ö‡∏Ñ‡∏µ‡∏£‡∏µ‡∏Ç‡∏±‡∏ô‡∏ò‡πå','‡∏õ‡∏£‡∏≤‡∏à‡∏µ‡∏ô‡∏ö‡∏∏‡∏£‡∏µ','‡∏õ‡∏±‡∏ï‡∏ï‡∏≤‡∏ô‡∏µ','‡∏û‡∏£‡∏∞‡∏ô‡∏Ñ‡∏£‡∏®‡∏£‡∏µ‡∏≠‡∏¢‡∏∏‡∏ò‡∏¢‡∏≤','‡∏û‡∏∞‡πÄ‡∏¢‡∏≤','‡∏û‡∏±‡∏á‡∏á‡∏≤','‡∏û‡∏±‡∏ó‡∏•‡∏∏‡∏á','‡∏û‡∏¥‡∏à‡∏¥‡∏ï‡∏£','‡∏û‡∏¥‡∏©‡∏ì‡∏∏‡πÇ‡∏•‡∏Å','‡πÄ‡∏û‡∏ä‡∏£‡∏ö‡∏∏‡∏£‡∏µ','‡πÄ‡∏û‡∏ä‡∏£‡∏ö‡∏π‡∏£‡∏ì‡πå','‡πÅ‡∏û‡∏£‡πà','‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï','‡∏°‡∏´‡∏≤‡∏™‡∏≤‡∏£‡∏Ñ‡∏≤‡∏°','‡∏°‡∏∏‡∏Å‡∏î‡∏≤‡∏´‡∏≤‡∏£','‡πÅ‡∏°‡πà‡∏Æ‡πà‡∏≠‡∏á‡∏™‡∏≠‡∏ô','‡∏¢‡πÇ‡∏™‡∏ò‡∏£','‡∏¢‡∏∞‡∏•‡∏≤','‡∏£‡πâ‡∏≠‡∏¢‡πÄ‡∏≠‡πá‡∏î','‡∏£‡∏∞‡∏ô‡∏≠‡∏á','‡∏£‡∏∞‡∏¢‡∏≠‡∏á','‡∏£‡∏≤‡∏ä‡∏ö‡∏∏‡∏£‡∏µ','‡∏•‡∏û‡∏ö‡∏∏‡∏£‡∏µ','‡∏•‡∏≥‡∏õ‡∏≤‡∏á','‡∏•‡∏≥‡∏û‡∏π‡∏ô','‡πÄ‡∏•‡∏¢','‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏©','‡∏™‡∏Å‡∏•‡∏ô‡∏Ñ‡∏£','‡∏™‡∏á‡∏Ç‡∏•‡∏≤','‡∏™‡∏ï‡∏π‡∏•','‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏õ‡∏£‡∏≤‡∏Å‡∏≤‡∏£','‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏™‡∏á‡∏Ñ‡∏£‡∏≤‡∏°','‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏™‡∏≤‡∏Ñ‡∏£','‡∏™‡∏£‡∏∞‡πÅ‡∏Å‡πâ‡∏ß','‡∏™‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏µ','‡∏™‡∏¥‡∏á‡∏´‡πå‡∏ö‡∏∏‡∏£‡∏µ','‡∏™‡∏∏‡πÇ‡∏Ç‡∏ó‡∏±‡∏¢','‡∏™‡∏∏‡∏û‡∏£‡∏£‡∏ì‡∏ö‡∏∏‡∏£‡∏µ','‡∏™‡∏∏‡∏£‡∏≤‡∏©‡∏é‡∏£‡πå‡∏ò‡∏≤‡∏ô‡∏µ','‡∏™‡∏∏‡∏£‡∏¥‡∏ô‡∏ó‡∏£‡πå','‡∏´‡∏ô‡∏≠‡∏á‡∏Ñ‡∏≤‡∏¢','‡∏´‡∏ô‡∏≠‡∏á‡∏ö‡∏±‡∏ß‡∏•‡∏≥‡∏†‡∏π','‡∏≠‡πà‡∏≤‡∏á‡∏ó‡∏≠‡∏á','‡∏≠‡∏≥‡∏ô‡∏≤‡∏à‡πÄ‡∏à‡∏£‡∏¥‡∏ç','‡∏≠‡∏∏‡∏î‡∏£‡∏ò‡∏≤‡∏ô‡∏µ','‡∏≠‡∏∏‡∏ï‡∏£‡∏î‡∏¥‡∏ï‡∏ñ‡πå','‡∏≠‡∏∏‡∏ó‡∏±‡∏¢‡∏ò‡∏≤‡∏ô‡∏µ','‡∏≠‡∏∏‡∏ö‡∏•‡∏£‡∏≤‡∏ä‡∏ò‡∏≤‡∏ô‡∏µ'];

// ========== INIT ==========
async function init() {
  // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ WORKER_URL ‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á
  if (WORKER_URL.includes('YOUR_WORKER_URL') || WORKER_URL === '') {
    document.getElementById('db-status').innerHTML = '<span style="color:var(--red)">‚ö†Ô∏è ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Worker URL</span>';
    document.getElementById('loading-overlay').style.display = 'none';
    alert('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ WORKER_URL ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå HTML ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö Cloudflare Worker ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì');
    return;
  }
  showLoading('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ NocoDB...');
  try {
    await Promise.all([loadMembers(), loadTeams(), loadPayments()]);
    hideLoading();
    document.getElementById('db-status').innerHTML = '<span style="color:var(--green)">üü¢ NocoDB Connected</span>';
    populateRegTeams();
    populateRegProvinces();
    setTodayDate();
  } catch(e) {
    hideLoading();
    const errMsg = e.message || 'Unknown error';
    document.getElementById('db-status').innerHTML = `<span style="color:var(--red)" title="${errMsg}">üî¥ Connection Error</span>`;
    console.error('TCC Init Error:', errMsg, e);
    // ‡πÅ‡∏™‡∏î‡∏á error banner ‡πÉ‡∏ô UI
    const banner = document.createElement('div');
    banner.style.cssText = 'position:fixed;top:70px;left:0;right:0;z-index:150;background:rgba(246,70,93,0.15);border-bottom:1px solid rgba(246,70,93,0.4);padding:10px 20px;color:#F6465D;font-size:0.85rem;text-align:center;';
    const hint = (errMsg.includes('Failed to fetch') || errMsg.includes('NetworkError'))
      ? '‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Worker ‡πÑ‡∏î‡πâ ‚Äî ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö: (1) WORKER_URL ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (2) Worker deploy ‡∏≠‡∏¢‡∏π‡πà (3) origin ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ñ‡∏π‡∏Å whitelist ‡πÉ‡∏ô ALLOWED_ORIGINS ‡∏Ç‡∏≠‡∏á Worker'
      : `‚ö†Ô∏è Connection Error: ${errMsg}`;
    banner.innerHTML = hint + ' <button onclick="this.parentElement.remove()" style="margin-left:10px;background:none;border:1px solid rgba(246,70,93,0.5);color:#F6465D;border-radius:4px;padding:2px 8px;cursor:pointer;">‚úï</button>';
    document.body.appendChild(banner);
  }
}

async function loadMembers() {
  const data = await ndbFetch('members', { limit: 500 });
  MEMBERS = data.list || data.data?.list || [];
  document.getElementById('stat-members').textContent = MEMBERS.length;
}

async function loadTeams() {
  const data = await ndbFetch('teams', { limit: 100 });
  TEAMS = data.list || data.data?.list || [];
  document.getElementById('stat-teams').textContent = TEAMS.length;
  renderTeams();
}

async function loadPayments() {
  const data = await ndbFetch('payments', { limit: 500, sort: '-Id' });
  PAYMENTS = data.list || data.data?.list || [];

  // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì stats ‡∏à‡∏≤‡∏Å field names ‡∏à‡∏£‡∏¥‡∏á
  const total = PAYMENTS.reduce((s, p) => s + payNum(p, 'profit'), 0);
  const pending = PAYMENTS.filter(p => payVal(p, 'position') === 'Pending').length;

  document.getElementById('stat-payments').textContent = PAYMENTS.length;
  document.getElementById('stat-pending').textContent = pending;
  document.getElementById('stat-total-profit').textContent =
    '$' + total.toLocaleString('en', {minimumFractionDigits:2, maximumFractionDigits:2});

  const adminEl = document.getElementById('admin-stat-label');
  if (adminEl) adminEl.textContent = `‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${PAYMENTS.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;

  renderRecentPayments();
  renderAdminPayments();
}

// ========== RENDER ==========
function renderRecentPayments() {
  const tbody = document.getElementById('recent-payments-table');
  const rows = PAYMENTS.slice(0, 10);
  if (!rows.length) { tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;color:var(--text-muted);padding:20px;">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>'; return; }
  tbody.innerHTML = rows.map(p => {
    const status = payVal(p, 'position');
    const profit = payNum(p, 'profit');
    const member = payNum(p, 'member');
    const name   = payVal(p, 'name');
    const team   = payVal(p, 'team');
    const date   = payVal(p, 'date');
    const isApprove = status === 'Approve';
    return `<tr onclick="showPaymentDetail('${p.Id}')" style="cursor:pointer;">
      <td>${date}</td><td>${name}</td>
      <td style="color:var(--text-muted)">${team}</td>
      <td style="color:var(--gold)">$${profit.toFixed(2)}</td>
      <td style="color:var(--green)">$${member.toFixed(2)}</td>
      <td><span class="badge ${isApprove?'badge-approve':'badge-pending'}">${isApprove?'‚úÖ ‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß':'‚è≥ ‡∏£‡∏≠‡∏ä‡∏≥‡∏£‡∏∞'}</span></td>
    </tr>`;
  }).join('');
}

function renderAdminPayments() {
  const tbody = document.getElementById('admin-payments-table');
  if (!tbody) return;
  const rows = PAYMENTS.slice(0, 20);
  if (!rows.length) { tbody.innerHTML = '<tr><td colspan="9" style="text-align:center;color:var(--text-muted);padding:20px;">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>'; return; }
  tbody.innerHTML = rows.map(p => {
    const status   = payVal(p, 'position');
    const profit   = payNum(p, 'profit');
    const member   = payNum(p, 'member');
    const transfer = payNum(p, 'transfer');
    const isApprove = status === 'Approve';
    return `<tr>
      <td>${payVal(p,'date')}</td>
      <td style="color:var(--text-muted);font-size:0.75rem">${payVal(p,'bnb_id')}</td>
      <td>${payVal(p,'name')}</td>
      <td>${payVal(p,'team')}</td>
      <td style="color:var(--gold)">$${profit.toFixed(2)}</td>
      <td style="color:var(--green)">$${member.toFixed(2)}</td>
      <td style="color:var(--gold)">$${transfer.toFixed(2)}</td>
      <td><span class="badge ${isApprove?'badge-approve':'badge-pending'}">${isApprove?'‚úÖ ‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß':'‚è≥ ‡∏£‡∏≠‡∏ä‡∏≥‡∏£‡∏∞'}</span></td>
      <td>${!isApprove?`<button class="btn btn-success btn-sm" onclick="approvePayment('${p.Id}',this)">‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>`:'<span style="color:var(--text-muted);font-size:0.8rem">‚Äî</span>'}</td>
    </tr>`;
  }).join('');
}

function renderTeams() {
  const container = document.getElementById('teams-list');
  if (!container) return;
  if (!TEAMS.length) { container.innerHTML = '<div style="text-align:center;padding:30px;color:var(--text-muted);">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>'; return; }
  container.innerHTML = TEAMS.map(t => {
    const name = teamVal(t, 'name');
    const status = teamVal(t, 'status');
    const membersCount = MEMBERS.filter(m => memVal(m,'team') === name).length;
    return `<div style="display:flex;align-items:center;justify-content:space-between;padding:12px;border-bottom:1px solid rgba(255,255,255,0.05);">
      <div>
        <div style="font-weight:600">${name || '‚Äî'}</div>
        <div style="font-size:0.8rem;color:var(--text-muted)">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ${status||'‚Äî'}</div>
      </div>
      <span style="font-size:0.8rem;color:var(--text-muted)">${membersCount} ‡∏Ñ‡∏ô</span>
    </div>`;
  }).join('');
}

// ========== SEARCH ==========
function searchMember() {
  const q = document.getElementById('member-search-input').value.toLowerCase().trim();
  const container = document.getElementById('member-search-results');
  const list = document.getElementById('member-results-list');
  if (q.length < 1) { container.style.display = 'none'; return; }
  const results = MEMBERS.filter(m => {
    const name = memVal(m, 'name').toLowerCase();
    const id   = memVal(m, 'id').toLowerCase();
    return name.includes(q) || id.includes(q);
  });
  container.style.display = 'block';
  if (!results.length) { list.innerHTML = '<div style="color:var(--text-muted);text-align:center;padding:16px;">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>'; return; }
  list.innerHTML = results.slice(0, 6).map(m => {
    const name   = memVal(m, 'name');
    const id     = memVal(m, 'id');
    const team   = memVal(m, 'team');
    const status = memVal(m, 'status');
    return `<div onclick="showMemberDashboard('${id}')" style="display:flex;align-items:center;gap:12px;padding:10px;border-radius:8px;cursor:pointer;margin-bottom:4px;background:var(--dark3);transition:all 0.2s;" onmouseover="this.style.background='var(--dark4)'" onmouseout="this.style.background='var(--dark3)'">
      <div style="width:36px;height:36px;background:rgba(240,185,11,0.2);border-radius:50%;display:flex;align-items:center;justify-content:center;">üë§</div>
      <div><div style="font-weight:600">${name}</div><div style="font-size:0.75rem;color:var(--text-muted)">ID: ${id} | ${team}</div></div>
      <span class="badge ${status==='Pending'?'badge-pending':'badge-approve'}" style="margin-left:auto">${status||'Active'}</span>
    </div>`;
  }).join('');
}

function showMemberDashboard(memberId) {
  const m = MEMBERS.find(x => memVal(x,'id') === String(memberId));
  if (!m) return;
  document.getElementById('member-search-results').style.display = 'none';
  document.getElementById('member-dashboard').style.display = 'block';
  document.getElementById('dash-name').textContent   = memVal(m,'name');
  document.getElementById('dash-id').textContent     = memVal(m,'id');
  document.getElementById('dash-team').textContent   = memVal(m,'team');
  const status = memVal(m,'status');
  document.getElementById('dash-status').innerHTML   = `<span class="badge ${status==='Pending'?'badge-pending':'badge-approve'}">${status||'Active'}</span>`;
  document.getElementById('dash-wallet').textContent = memVal(m,'wallet') || '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤';

  // ‡∏´‡∏≤ payments ‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö BNB_ID ‚Äî payments ‡πÉ‡∏ä‡πâ Field 1 ‡πÄ‡∏õ‡πá‡∏ô BNB_ID
  currentMemberPayments = PAYMENTS.filter(p => payVal(p,'bnb_id') === String(memberId));
  renderMemberPayments(currentMemberPayments);
  document.getElementById('member-dashboard').scrollIntoView({behavior:'smooth'});
}

function closeMemberDash() {
  document.getElementById('member-dashboard').style.display = 'none';
  document.getElementById('member-search-input').value = '';
  document.getElementById('member-search-results').style.display = 'none';
}

function filterPayments(status) {
  const filtered = status === 'all'
    ? currentMemberPayments
    : currentMemberPayments.filter(p => payVal(p,'position') === status);
  renderMemberPayments(filtered);
}

function renderMemberPayments(payments) {
  const tbody  = document.getElementById('member-payments-table');
  const noData = document.getElementById('member-no-data');
  if (!payments.length) { tbody.innerHTML = ''; noData.style.display = 'block'; return; }
  noData.style.display = 'none';
  tbody.innerHTML = payments.map(p => {
    const status = payVal(p, 'position');
    const profit = payNum(p, 'profit');
    const comm   = payNum(p, 'commission');
    const guar   = payNum(p, 'guarantee');
    const bal    = payNum(p, 'balance');
    const mem    = payNum(p, 'member');
    const cen    = payNum(p, 'central');
    const trans  = payNum(p, 'transfer');
    const isApprove = status === 'Approve';
    return `<tr onclick="showPaymentDetail('${p.Id}')" style="cursor:pointer;">
      <td>${payVal(p,'date')}</td>
      <td style="color:var(--gold)">$${profit.toFixed(2)}</td>
      <td style="color:var(--red)">$${comm.toFixed(2)}</td>
      <td style="color:var(--red)">$${guar.toFixed(2)}</td>
      <td>$${bal.toFixed(2)}</td>
      <td style="color:var(--green)">$${mem.toFixed(2)}</td>
      <td>$${cen.toFixed(2)}</td>
      <td style="color:var(--gold)">$${trans.toFixed(2)}</td>
      <td><span class="badge ${isApprove?'badge-approve':'badge-pending'}">${isApprove?'‚úÖ ‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß':'‚è≥ ‡∏£‡∏≠‡∏ä‡∏≥‡∏£‡∏∞'}</span></td>
    </tr>`;
  }).join('');
}

// ========== ADMIN SEARCH ==========
function adminSearchMember() {
  const q = document.getElementById('admin-search').value.toLowerCase().trim();
  const container = document.getElementById('admin-search-results');
  if (q.length < 1) { container.innerHTML = ''; return; }
  const results = MEMBERS.filter(m => {
    const name = memVal(m,'name').toLowerCase();
    const id   = memVal(m,'id');
    return name.includes(q) || id.includes(q);
  });
  if (!results.length) { container.innerHTML = '<div style="color:var(--text-muted);text-align:center;padding:16px;">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>'; return; }
  container.innerHTML = results.slice(0,5).map(m => {
    const name = memVal(m,'name');
    const id   = memVal(m,'id');
    const team = memVal(m,'team');
    return `<div onclick="selectAdminMember('${id}')" style="display:flex;align-items:center;gap:12px;padding:10px;border-radius:8px;cursor:pointer;margin-bottom:4px;background:var(--dark3);">
      <div><div style="font-weight:600">${name}</div><div style="font-size:0.75rem;color:var(--text-muted)">ID: ${id} | ${team}</div></div>
      <button class="btn btn-gold btn-sm" style="margin-left:auto">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</button>
    </div>`;
  }).join('');
}


// ========== TRADE ROWS ==========
function addTradeRow() {
  tradeRows.push({ coin: 'BTC', profit: 0 });
function selectAdminMember(memberId) {
  const m = MEMBERS.find(x => memVal(x,'id') === String(memberId));
  if (!m) return;
  selectedAdminMember = m;
  document.getElementById('af-id').textContent   = memVal(m,'id');
  document.getElementById('af-name').textContent  = memVal(m,'name');
  document.getElementById('af-team').textContent  = memVal(m,'team');
  document.getElementById('af-lva').textContent   = memVal(m,'lva') || '‚Äî';
  document.getElementById('af-lvb').textContent   = memVal(m,'lvb') || '‚Äî';
  document.getElementById('admin-search').value = '';
  document.getElementById('admin-search-results').innerHTML = '';
  document.getElementById('admin-payment-form').style.display = 'block';
  tradeRows = [];
  renderTradeRows();
  updateCalc();
  document.getElementById('admin-payment-form').scrollIntoView({behavior:'smooth'});
}

function renderTradeRows() {
  const container = document.getElementById('trade-rows');
  if (!tradeRows.length) { container.innerHTML = '<div style="text-align:center;color:var(--text-muted);padding:20px;font-size:0.85rem;">‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏ó‡∏£‡∏î</div>'; return; }
  container.innerHTML = tradeRows.map((row, i) => `
    <div class="trade-item">
      <div class="trade-item-num">${i+1}</div>
      <div style="flex:1.5;min-width:120px;">
        <div style="font-size:0.7rem;color:var(--text-muted);margin-bottom:4px">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç</div>
        <select class="form-control" onchange="tradeRows[${i}].coin=this.value">
          ${COINS.map(c => `<option value="${c}" ${row.coin===c?'selected':''}>${c}/USDT</option>`).join('')}
        </select>
      </div>
      <div style="flex:1.5;min-width:120px;">
        <div style="font-size:0.7rem;color:var(--text-muted);margin-bottom:4px">‡∏Å‡∏≥‡πÑ‡∏£ (USD)</div>
        <input type="number" class="form-control" placeholder="0.00" value="${row.profit||''}" min="0" step="0.01" oninput="tradeRows[${i}].profit=parseFloat(this.value)||0; updateCalc();">
      </div>
      <button class="btn btn-danger btn-sm" onclick="removeTradeRow(${i})" style="margin-top:16px;">üóëÔ∏è</button>
    </div>`).join('');
}

function removeTradeRow(i) { tradeRows.splice(i, 1); renderTradeRows(); updateCalc(); }

function updateCalc() {
  const total = tradeRows.reduce((s, r) => s + (r.profit||0), 0);
  document.getElementById('total-trade-profit').textContent = `$${total.toFixed(2)}`;
  const comm = total*0.10, guar = total*0.10, bal = total*0.80, mem = bal*0.50, cen = bal*0.50, trans = cen+comm;
  document.getElementById('calc-total').textContent = `$${total.toFixed(2)}`;
  document.getElementById('calc-guarantee').textContent = `-$${guar.toFixed(2)}`;
  document.getElementById('calc-commission').textContent = `-$${comm.toFixed(2)}`;
  document.getElementById('calc-balance').textContent = `$${bal.toFixed(2)}`;
  document.getElementById('calc-member').textContent = `$${mem.toFixed(2)}`;
  document.getElementById('calc-central').textContent = `$${cen.toFixed(2)}`;
  document.getElementById('calc-transfer').textContent = `$${trans.toFixed(2)}`;
}

// ========== SAVE PAYMENT to NocoDB ==========
async function savePayment() {
  if (!selectedAdminMember) { alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏Å‡πà‡∏≠‡∏ô'); return; }
  const total = tradeRows.reduce((s, r) => s + (r.profit||0), 0);
  if (total <= 0) { alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏ó‡∏£‡∏î‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£'); return; }

  const comm = total*0.10, guar = total*0.10, bal = total*0.80, mem = bal*0.50, cen = bal*0.50, trans = cen+comm;
  const status  = document.getElementById('af-position').value;
  const payDate = document.getElementById('af-payment-date').value;
  const note    = document.getElementById('af-note').value;
  const today   = new Date();
  // ‡πÅ‡∏õ‡∏•‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏≤‡∏Å yyyy-mm-dd ‡πÄ‡∏õ‡πá‡∏ô d/m/yyyy
  let dateStr;
  if (payDate) {
    const [y,mo,d] = payDate.split('-');
    dateStr = `${parseInt(d)}/${parseInt(mo)}/${y}`;
  } else {
    dateStr = `${today.getDate()}/${today.getMonth()+1}/${today.getFullYear()}`;
  }
  const tradeNote = tradeRows.map((t,i) => `‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà${i+1}: ${t.coin} +$${t.profit}`).join(' | ');

  // ‡πÉ‡∏ä‡πâ field names ‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏≤‡∏Å NocoDB payments table
  const payload = {
    'Field 1':  memVal(selectedAdminMember, 'id'),       // BNB_ID
    'Field 2':  memVal(selectedAdminMember, 'team'),     // Team
    'Field 3':  memVal(selectedAdminMember, 'name'),     // Name
    'Field 4':  memVal(selectedAdminMember, 'lva'),      // Level A
    'Field 5':  memVal(selectedAdminMember, 'lvb'),      // Level B
    'Field 6':  dateStr,                                 // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
    'Field 8':  `$${total.toFixed(2)}`,                  // Total Profit
    '10.00%':   `$${comm.toFixed(2)}`,                   // Commission
    '10.00%1':  `$${guar.toFixed(2)}`,                   // Profit Guarantee
    'Field 11': `$${bal.toFixed(2)}`,                    // Total Balance
    '50.00%':   `$${mem.toFixed(2)}`,                    // Member 50%
    '50.00%1':  `$${cen.toFixed(2)}`,                    // Central 50%
    'Field 14': `$${trans.toFixed(2)}`,                  // Total Transfer
    'Field 15': status,                                  // Position
    'Field 16': note || tradeNote                        // Note
  };

  const btn = document.querySelector('[onclick="savePayment()"]');
  btn.textContent = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...'; btn.disabled = true;
  const resultEl = document.getElementById('save-result');

  try {
    await ndbInsert('payments', payload);
    resultEl.innerHTML = '<div class="api-success">‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á NocoDB ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</div>';
    await loadPayments();
    clearAdminForm();
    showSuccess('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', `‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏´‡πâ ${memVal(selectedAdminMember,'name')} ‡∏•‡∏á NocoDB ‡πÅ‡∏•‡πâ‡∏ß`);
  } catch(e) {
    resultEl.innerHTML = `<div class="api-error">‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${e.message}</div>`;
    btn.textContent = 'üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ NocoDB'; btn.disabled = false;
  }
}

function clearAdminForm() {
  selectedAdminMember = null; tradeRows = [];
  document.getElementById('admin-payment-form').style.display = 'none';
  document.getElementById('admin-search').value = '';
  document.getElementById('save-result').innerHTML = '';
  const btn = document.querySelector('[onclick="savePayment()"]');
  if (btn) { btn.textContent = 'üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ NocoDB'; btn.disabled = false; }
}

async function approvePayment(rowId, btnEl) {
  btnEl.textContent = '‚è≥...'; btnEl.disabled = true;
  try {
    await ndbUpdate('payments', rowId, { 'Field 15': 'Approve' }); // Field 15 = Position
    await loadPayments();
    showSuccess('‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏ô NocoDB ‡πÅ‡∏•‡πâ‡∏ß');
  } catch(e) {
    btnEl.textContent = '‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥'; btnEl.disabled = false;
    alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + e.message);
  }
}

// ========== PAYMENT DETAIL MODAL ==========
function showPaymentDetail(rowId) {
  const p = PAYMENTS.find(x => String(x.Id) === String(rowId));
  if (!p) return;
  const now    = new Date();
  const profit = payNum(p, 'profit');
  const comm   = payNum(p, 'commission');
  const guar   = payNum(p, 'guarantee');
  const bal    = payNum(p, 'balance');
  const mem    = payNum(p, 'member');
  const cen    = payNum(p, 'central');
  const trans  = payNum(p, 'transfer');
  const status = payVal(p, 'position');
  const isPending = status !== 'Approve';
  const lvaComm = comm * 0.15, lvbComm = comm * 0.10;
  const lva   = payVal(p, 'lva');
  const lvb   = payVal(p, 'lvb');
  const name  = payVal(p, 'name');
  const bnbId = payVal(p, 'bnb_id');
  const team  = payVal(p, 'team');
  const date  = payVal(p, 'date');
  const note  = payVal(p, 'note');

  document.getElementById('payment-modal-content').innerHTML = `
    <div style="background:var(--dark3);border-radius:12px;overflow:hidden;">
      <div style="background:linear-gradient(135deg,#1a1f28,#0f1318);padding:16px 20px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;">
        <div style="display:flex;align-items:center;gap:10px;">
          <img src="https://i.ibb.co/NbQpSTX/TCC-Logo.png" style="height:28px;" onerror="this.style.display='none'">
          <div>
            <div style="font-family:'Orbitron',monospace;font-size:0.8rem;color:var(--gold);letter-spacing:2px;">PAYMENT REPORT</div>
            <div style="display:flex;align-items:center;gap:6px;margin-top:2px;">
              <div class="pulse" style="width:6px;height:6px;"></div>
              <span style="font-size:0.7rem;color:var(--green);">LIVE</span>
              <span style="font-size:0.7rem;color:var(--text-muted);">${now.getDate()}/${now.getMonth()+1}/${now.getFullYear()}</span>
            </div>
          </div>
        </div>
        <div style="font-size:0.7rem;color:var(--gold);border:1px solid var(--border);padding:3px 10px;border-radius:20px;">‚ú¶ OFFICIAL</div>
      </div>
      <div style="padding:16px 20px;">
        <div style="display:flex;align-items:center;gap:12px;margin-bottom:14px;">
          <div style="width:44px;height:44px;background:linear-gradient(135deg,var(--gold),var(--gold-dark));border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.2rem;flex-shrink:0;">üë§</div>
          <div style="flex:1;">
            <div style="font-size:1rem;font-weight:700;">${name}</div>
            <div style="display:flex;gap:10px;margin-top:3px;flex-wrap:wrap;">
              <span style="font-size:0.72rem;color:var(--text-muted);">ü™ô UID: <b style="color:var(--gold)">${bnbId}</b></span>
              <span style="font-size:0.72rem;color:var(--text-muted);">üèÜ ${team}</span>
            </div>
            <div style="font-size:0.72rem;color:var(--text-muted);margin-top:2px;">üìà TEAM COMMISSION: <b style="color:var(--gold)">$${comm.toFixed(2)}</b></div>
          </div>
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:12px;">
          <div style="background:rgba(3,192,117,0.08);border:1px solid rgba(3,192,117,0.2);border-radius:8px;padding:8px;">
            <div style="font-size:0.65rem;color:var(--text-muted);">A - ${lva||'‚Äî'}</div>
            <div style="font-weight:700;color:var(--green);">$${lvaComm.toFixed(2)}</div>
          </div>
          <div style="background:rgba(240,185,11,0.08);border:1px solid rgba(240,185,11,0.2);border-radius:8px;padding:8px;">
            <div style="font-size:0.65rem;color:var(--text-muted);">B - ${lvb||'‚Äî'}</div>
            <div style="font-weight:700;color:var(--gold);">$${lvbComm.toFixed(2)}</div>
          </div>
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:6px;margin-bottom:12px;">
          <div style="background:var(--dark2);border:1px solid var(--border);border-radius:8px;padding:10px;text-align:center;">
            <div style="font-size:0.6rem;color:var(--text-muted);">‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏ö‡πà‡∏á‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å (50%)</div>
            <div style="font-size:1rem;font-weight:700;color:var(--green);">$${mem.toFixed(2)}</div>
          </div>
          <div style="background:var(--dark2);border:1px solid var(--border);border-radius:8px;padding:10px;text-align:center;">
            <div style="font-size:0.6rem;color:var(--text-muted);">‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏Å‡∏≥‡πÑ‡∏£ (10%)</div>
            <div style="font-size:1rem;font-weight:700;color:var(--gold);">$${guar.toFixed(2)}</div>
          </div>
          <div style="background:linear-gradient(135deg,rgba(240,185,11,0.15),rgba(240,185,11,0.05));border:1px solid var(--gold);border-radius:8px;padding:10px;text-align:center;">
            <div style="font-size:0.6rem;color:var(--text-muted);">‚≠ê ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏°</div>
            <div style="font-size:1rem;font-weight:700;color:var(--gold);">$${(mem+guar).toFixed(2)}</div>
          </div>
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:12px;">
          <div>
            <div style="font-size:0.72rem;color:var(--gold);font-weight:600;margin-bottom:6px;">üìä ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏ö‡πà‡∏á</div>
            <div style="background:var(--dark2);border-radius:8px;padding:10px;">
              ${[['‡∏Å‡∏≥‡πÑ‡∏£‡∏£‡∏ß‡∏° (100%)',`+$${profit.toFixed(2)}`,'var(--green)'],['‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏Å‡∏≥‡πÑ‡∏£ (10%)',`-$${guar.toFixed(2)}`,'var(--red)'],['‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏°‡∏°‡∏¥‡∏ä‡∏±‡πà‡∏ô (10%)',`-$${comm.toFixed(2)}`,'var(--red)'],['‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏™‡∏∏‡∏ó‡∏ò‡∏¥ (80%)',`$${bal.toFixed(2)}`,'var(--gold)'],['‡∏™‡πà‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏ó‡∏£‡∏î (50%)',`$${mem.toFixed(2)}`,'var(--green)'],['‡∏™‡πà‡∏ß‡∏ô‡∏£‡∏∞‡∏ö‡∏ö (50%)',`$${cen.toFixed(2)}`,'var(--gold)']].map(([l,v,c])=>`
              <div style="display:flex;justify-content:space-between;padding:4px 0;font-size:0.78rem;border-bottom:1px solid rgba(255,255,255,0.04);">
                <span style="color:var(--text-muted)">${l}</span><span style="color:${c};font-weight:600">${v}</span>
              </div>`).join('')}
            </div>
          </div>
          <div>
            <div style="font-size:0.72rem;color:var(--gold);font-weight:600;margin-bottom:6px;">üí≥ ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</div>
            <div style="background:var(--dark2);border-radius:8px;padding:10px;margin-bottom:8px;">
              ${[['‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏°‡∏°‡∏¥‡∏ä‡∏±‡πà‡∏ô',`$${comm.toFixed(2)}`],['‡∏™‡πà‡∏ß‡∏ô‡∏£‡∏∞‡∏ö‡∏ö',`$${cen.toFixed(2)}`]].map(([l,v])=>`
              <div style="display:flex;justify-content:space-between;padding:4px 0;font-size:0.78rem;border-bottom:1px solid rgba(255,255,255,0.04);">
                <span style="color:var(--text-muted)">${l}</span><span style="color:var(--gold);font-weight:600">${v}</span>
              </div>`).join('')}
              <div style="display:flex;justify-content:space-between;padding:6px 0 0;font-size:0.8rem;font-weight:700;">
                <span>üîñ ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°</span><span style="color:var(--gold)">$${trans.toFixed(2)}</span>
              </div>
            </div>
            <div style="font-size:0.65rem;color:var(--text-muted);text-align:center;margin-bottom:5px;">TOTAL PAYMENT AMOUNT</div>
            <div style="background:linear-gradient(135deg,var(--gold),var(--gold-dark));border-radius:10px;padding:12px;text-align:center;">
              <div style="font-size:0.7rem;color:rgba(0,0,0,0.6)">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</div>
              <div style="font-family:'Orbitron',monospace;font-size:1.2rem;font-weight:900;color:var(--black);">$${trans.toFixed(2)}</div>
            </div>
          </div>
        </div>
        ${isPending ? `
        <div style="margin-bottom:12px;">
          <div style="font-size:0.72rem;color:var(--gold);font-weight:600;margin-bottom:6px;">üîê SCAN QR CODE FOR PAYMENT</div>
          <div style="background:var(--dark2);border:1px solid var(--border);border-radius:8px;padding:10px;display:flex;align-items:center;gap:8px;margin-bottom:6px;">
            <span style="font-family:monospace;font-size:0.7rem;color:var(--gold);word-break:break-all;flex:1;">${NDB.SYSTEM_WALLET}</span>
            <button onclick="navigator.clipboard.writeText('${NDB.SYSTEM_WALLET}').then(()=>showToast('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß!'))" style="background:rgba(240,185,11,0.15);border:1px solid var(--gold);color:var(--gold);padding:4px 8px;border-radius:6px;cursor:pointer;font-size:0.7rem;flex-shrink:0;">üìã Copy</button>
          </div>
          <div style="font-size:0.65rem;color:var(--green);text-align:center;">‚ú¶ USDT BNB Smart Chain (BEP-20)</div>
        </div>` : ''}
        <div style="display:flex;justify-content:space-between;align-items:center;padding:10px;background:var(--dark2);border-radius:8px;border:1px solid ${isPending?'rgba(240,185,11,0.3)':'rgba(3,192,117,0.3)'};">
          <span style="font-weight:600;color:${isPending?'var(--gold)':'var(--green)'};">${isPending?'‚è≥ ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô':'‚úÖ ‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß'}</span>
          <span style="font-size:0.75rem;color:var(--text-muted);">üìÖ ${date}</span>
        </div>
        ${note?`<div style="margin-top:8px;font-size:0.8rem;color:var(--text-muted);">üìù ${note}</div>`:''}
        <div style="text-align:center;margin-top:14px;padding-top:10px;border-top:1px solid var(--border);">
          <div style="font-family:'Orbitron',monospace;font-size:0.65rem;color:var(--text-muted);letter-spacing:2px;">TRADERCAFECLUB</div>
          <div style="font-size:0.6rem;color:var(--green);margin-top:3px;">üîí Secured & Encrypted ‚ú¶ Verified</div>
        </div>
      </div>
    </div>`;
  document.getElementById('payment-modal').classList.add('open');
}

// ========== REGISTER ‚Üí NocoDB ==========
function populateRegTeams() {
  const sel = document.getElementById('reg-team');
  // Teams ‡πÉ‡∏ä‡πâ field '‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡∏°' ‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°
  TEAMS.forEach(t => {
    const name = teamVal(t, 'name');
    if (name && name.toLowerCase() !== 'non') {
      const o = document.createElement('option');
      o.value = name; o.textContent = name;
      sel.appendChild(o);
    }
  });
}

function populateRegProvinces() {
  const sel = document.getElementById('reg-province');
  PROVINCES.forEach(p => { const o = document.createElement('option'); o.value = p; o.textContent = p; sel.appendChild(o); });
}

function toggleProvince() {
  document.getElementById('province-group').style.display = document.getElementById('reg-country').value === 'TH' ? 'block' : 'none';
}

function regNext(step) {
  [1,2,3].forEach(s => { document.getElementById(`reg-step-${s}`).style.display='none'; document.getElementById(`step-${s}`).classList.remove('active'); });
  document.getElementById(`reg-step-${step}`).style.display = 'block';
  for (let i=1; i<=step; i++) document.getElementById(`step-${i}`).classList.add('active');
  if (step === 3) {
    const fields = ['reg-name','reg-phone','reg-team','reg-bnbid','reg-wallet','reg-province'].map(id => document.getElementById(id)?.value || '‚Äî');
    document.getElementById('reg-summary').innerHTML = [['‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•',fields[0]],['‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£',fields[1]],['‡∏ó‡∏µ‡∏°‡∏™‡∏±‡∏á‡∏Å‡∏±‡∏î',fields[2]],['Binance ID',fields[3]],['‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤',fields[4]],['‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î',fields[5]]].map(([k,v])=>`<div class="member-info-row"><span class="info-key">${k}</span><span class="info-val" style="font-size:0.8rem;word-break:break-all">${v}</span></div>`).join('');
  }
}

async function submitRegistration() {
  const name = document.getElementById('reg-name').value;
  const phone = document.getElementById('reg-phone').value;
  const team = document.getElementById('reg-team').value;
  const bnbid = document.getElementById('reg-bnbid').value;
  const wallet = document.getElementById('reg-wallet').value;
  const province = document.getElementById('reg-province').value;
  if (!name || !bnbid) { alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞ Binance ID'); return; }

  const btn = document.querySelector('[onclick="submitRegistration()"]');
  btn.textContent = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...'; btn.disabled = true;
  const resultEl = document.getElementById('reg-result');

  try {
    // Members ‡πÉ‡∏ä‡πâ field names ‡∏à‡∏£‡∏¥‡∏á: BNB_ID, Name, Team, Address Wallet, Status
    await ndbInsert('members', {
      'BNB_ID': bnbid,
      'Name': name,
      'Team': team,
      'Address Wallet': wallet,
      'Status': 'Pending'
    });
    resultEl.innerHTML = '<div class="api-success">‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏•‡∏á NocoDB ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</div>';
    await loadMembers();
    setTimeout(() => {
      showSuccess('‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', `‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å ${name} ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏∞‡∏ö‡∏ö NocoDB ‡πÅ‡∏•‡πâ‡∏ß`);
      regNext(1);
      document.getElementById('reg-name').value = '';
      resultEl.innerHTML = '';
      btn.textContent = '‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å'; btn.disabled = false;
    }, 1500);
  } catch(e) {
    resultEl.innerHTML = `<div class="api-error">‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${e.message}</div>`;
    btn.textContent = '‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å'; btn.disabled = false;
  }
}

// ========== UTILS ==========
function showPage(page) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.mobile-nav-btn').forEach(b => b.classList.remove('active'));
  document.getElementById(`page-${page}`)?.classList.add('active');
  const map = {home:0,'member-search':1,register:2,admin:3};
  const idx = map[page];
  if (idx !== undefined) {
    document.querySelectorAll('.nav-tab')[idx]?.classList.add('active');
    document.querySelectorAll('.mobile-nav-btn')[idx]?.classList.add('active');
  }
  window.scrollTo(0,0);
}

function showLoading(text = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...') {
  document.getElementById('loading-overlay').style.display = 'flex';
  document.getElementById('loading-text').textContent = text;
}
function hideLoading() { document.getElementById('loading-overlay').style.display = 'none'; }

function showSuccess(title, msg) {
  document.getElementById('success-title').textContent = title;
  document.getElementById('success-msg').textContent = msg;
  document.getElementById('success-modal').classList.add('open');
}

function showToast(msg) {
  const t = document.createElement('div');
  t.style.cssText = 'position:fixed;bottom:80px;left:50%;transform:translateX(-50%);background:var(--dark2);border:1px solid var(--gold);color:var(--gold);padding:10px 20px;border-radius:8px;z-index:999;font-size:0.85rem;';
  t.textContent = msg; document.body.appendChild(t);
  setTimeout(() => t.remove(), 2000);
}

function copyText(id) {
  const t = document.getElementById(id)?.textContent;
  if (t) navigator.clipboard.writeText(t).then(() => showToast('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß!')).catch(()=>{});
}

function copySystemWallet() { navigator.clipboard.writeText(NDB.SYSTEM_WALLET).then(() => showToast('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß!')).catch(()=>{}); }

function setTodayDate() {
  const today = new Date();
  const dd = String(today.getDate()).padStart(2,'0');
  const mm = String(today.getMonth()+1).padStart(2,'0');
  const yyyy = today.getFullYear();
  document.getElementById('af-date').textContent = `${dd}/${mm}/${yyyy}`;
  const el = document.getElementById('af-payment-date');
  if (el) el.value = `${yyyy}-${mm}-${dd}`;
}

async function checkBlockchain() {
  const resultEl = document.getElementById('blockchain-result');
  resultEl.innerHTML = '<div style="color:var(--text-muted);font-size:0.85rem;">‚ö° ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö BscScan...</div>';
  setTimeout(() => {
    resultEl.innerHTML = `<div style="background:rgba(3,192,117,0.1);border:1px solid rgba(3,192,117,0.3);border-radius:8px;padding:10px;margin-top:6px;"><div style="color:var(--green);font-weight:600;">‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ BscScan ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</div><div style="font-size:0.8rem;color:var(--text-muted);margin-top:4px;">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà: ${NDB.SYSTEM_WALLET.slice(0,12)}...${NDB.SYSTEM_WALLET.slice(-6)} | ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ 12 confirmations</div></div>`;
 